<template name="questionnaireForm">
  <div class="questionnaire-container">
    <h2>{{title}}</h2>
    
    {{> questionnaireRenderer 
        formData=currentFormData
        onChange=handleChange
        fullHeight=false}}
    <!-- Optional props (auto-detected if not provided):
         - schemaType: 'mieforms' or 'surveyjs' - Auto-detects from schema metadata
         - hideUnsupportedFields: boolean - Hide unsupported field types (default: true)
    -->
    
    <button class="submit-btn">Submit</button>
  </div>
</template>


<!-- File -->
<script>
import { Template } from 'meteor/templating';
import { ReactiveVar } from 'meteor/reactive-var';

// Import the Blaze component (React is bundled inside)
import '@mieweb/forms-renderer/blaze';

import './questionnaire.html';

Template.questionnaireForm.onCreated(function() {
  // Auto-detection example: Pass YAML or JSON string, or parsed object
  // The component will automatically detect:
  // 1. Format (YAML vs JSON)
  // 2. Schema type (MIE Forms vs SurveyJS)
  
  // Example 1: MIE Forms schema in YAML (auto-detected)
  const mieFormsYaml = `
- id: name
  fieldType: input
  question: What is your name?
  required: true
- id: age
  fieldType: input
  question: How old are you?
- id: gender
  fieldType: radio
  question: Gender
  options:
    - value: male
      label: Male
    - value: female
      label: Female
    - value: other
      label: Other
  `;
  
  // Example 2: SurveyJS schema in JSON (auto-detected and converted)
  const surveyJsJson = `{
    "pages": [{
      "elements": [
        {
          "type": "text",
          "name": "name",
          "title": "What is your name?",
          "isRequired": true
        },
        {
          "type": "text",
          "name": "age",
          "title": "How old are you?"
        },
        {
          "type": "radiogroup",
          "name": "gender",
          "title": "Gender",
          "choices": ["Male", "Female", "Other"]
        }
      ]
    }]
  }`;
  
  // Use either schema - both will auto-detect and render correctly
  this.questFormData = new ReactiveVar(mieFormsYaml);
  this.submittedData = new ReactiveVar(null);
});

Template.questionnaireForm.helpers({
  title() {
    return 'Patient Questionnaire';
  },
  
  currentFormData() {
    return Template.instance().questFormData.get();
  },
  
  handleChange() {
    const instance = Template.instance();
    return (updatedFormData) => {
      console.log('Form changed:', updatedFormData);
      instance.submittedData.set(updatedFormData);
    };
  }
});

Template.questionnaireForm.events({
  'click .submit-btn'(event, instance) {
    event.preventDefault();
    
    const submittedData = instance.submittedData.get();
    if (!submittedData) {
      alert('Please fill out the form');
      return;
    }
    
    Meteor.call('submitQuestionnaire', submittedData, (err) => {
      if (err) {
        alert('Error: ' + err.message);
      } else {
        alert('Submitted successfully!');
      }
    });
  }
});
</script>


<!-- CSS -->
<style>
.questionnaire-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

.submit-btn {
  margin-top: 2rem;
  padding: 0.75rem 2rem;
  background: #0076a8;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.submit-btn:hover {
  background: #00628a;
}
</style>
